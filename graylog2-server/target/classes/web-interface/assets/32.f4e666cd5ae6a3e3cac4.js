webpackJsonp([32],{1057:function(e,exports,t){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0});var a=t(2),r=s(a),n=t(15),i=t(1058),l=s(i),o=r.default.createClass({displayName:"CreateStreamButton",propTypes:{buttonText:r.default.PropTypes.string,bsStyle:r.default.PropTypes.string,bsSize:r.default.PropTypes.string,className:r.default.PropTypes.string,onSave:r.default.PropTypes.func.isRequired,indexSets:r.default.PropTypes.array.isRequired},getDefaultProps:function(){return{buttonText:"Create Stream"}},onClick:function(){this.refs.streamForm.open()},render:function(){return r.default.createElement("span",null,r.default.createElement(n.Button,{bsSize:this.props.bsSize,bsStyle:this.props.bsStyle,className:this.props.className,onClick:this.onClick},this.props.buttonText),r.default.createElement(l.default,{ref:"streamForm",title:"Creating Stream",indexSets:this.props.indexSets,onSubmit:this.props.onSave}))}});exports.default=o,e.exports=exports.default},1058:function(e,exports,t){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0});var a=t(2),r=s(a),n=t(968),i=s(n),l=t(264),o=s(l),u=t(49),m=t(48),c=t(86),d=s(c),f=d.default.get("IndexSets"),p=f.IndexSetsActions,h=r.default.createClass({displayName:"StreamForm",propTypes:{onSubmit:r.default.PropTypes.func.isRequired,stream:r.default.PropTypes.object.isRequired,title:r.default.PropTypes.string.isRequired,indexSets:r.default.PropTypes.array.isRequired},mixins:[i.default],getDefaultProps:function(){return{stream:{title:"",description:"",remove_matches_from_default_stream:!1,isFavoriteStream:!0}}},getInitialState:function(){return this._getValuesFromProps(this.props)},_resetValues:function(){this.setState(this._getValuesFromProps(this.props))},_getValuesFromProps:function(e){var t=e.stream.index_set_id;if(!t&&e.indexSets&&e.indexSets.length>0){var s=e.indexSets.find(function(e){return e.default});s&&(t=s.id)}return{title:e.stream.title,description:e.stream.description,remove_matches_from_default_stream:e.stream.remove_matches_from_default_stream,isFavoriteStream:e.stream.isFavoriteStream,index_set_id:t}},_onSubmit:function(){this.props.onSubmit(this.props.stream.id,{title:this.state.title,description:this.state.description,remove_matches_from_default_stream:this.state.remove_matches_from_default_stream,index_set_id:this.state.index_set_id,isFavoriteStream:this.state.isFavoriteStream}),this.refs.modal.close()},open:function(){this._resetValues(),p.list(!1),this.refs.modal.open()},close:function(){this.refs.modal.close()},_formatSelectOptions:function(){return this.props.indexSets.filter(function(e){return e.writable}).map(function(e){return{value:e.id,label:e.title}})},_onIndexSetSelect:function(e){this.linkState("index_set_id").requestChange(e)},render:function(){var e=void 0;return e=this.props.indexSets?r.default.createElement("div",{className:"form-group"},r.default.createElement("label",null,"Index Set"),r.default.createElement(m.Select,{placeholder:"Select index set",options:this._formatSelectOptions(),matchProp:"label",onValueChange:this._onIndexSetSelect,value:this.state.index_set_id}),r.default.createElement("p",{className:"help-block"},"Messages that match this stream will be written to the configured index set.")):r.default.createElement(m.Spinner,null,"Loading index sets..."),r.default.createElement(o.default,{ref:"modal",title:this.props.title,onSubmitForm:this._onSubmit,submitButtonText:"Save"},r.default.createElement(u.Input,{type:"text",required:!0,label:"Title",name:"Title",placeholder:"A descriptive name of the new stream",valueLink:this.linkState("title"),autoFocus:!0}),r.default.createElement(u.Input,{type:"text",required:!0,label:"Description",name:"Description",placeholder:"What kind of messages are routed into this stream?",valueLink:this.linkState("description")}),e,r.default.createElement(u.Input,{type:"checkbox",label:"Remove matches from 'All messages' stream",name:"Remove from All messages",help:r.default.createElement("span",null,"Remove messages that match this stream from the 'All messages' stream which is assigned to every message by default."),checkedLink:this.linkState("remove_matches_from_default_stream")}),r.default.createElement(u.Input,{type:"checkbox",label:"Favoris",name:"isFavoriteStream",help:r.default.createElement("span",null,"Favoris"),checkedLink:this.linkState("isFavoriteStream")}))}});exports.default=h,e.exports=exports.default},1141:function(e,exports,t){exports=e.exports=t(19)(),exports.push([e.i,".createStreamsCss{position:absolute;top:60px;right:20px}.addUserCss{position:absolute;top:110px;right:20px;width:153px;height:44px;font-size:18px}",""])},1147:function(e,exports,t){var s=t(1141);"string"==typeof s&&(s=[[e.i,s,""]]);t(20)(s,{});s.locals&&(e.exports=s.locals)},1183:function(e,exports,t){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function a(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function r(e,t){var s={};for(var a in e)t.indexOf(a)>=0||Object.prototype.hasOwnProperty.call(e,a)&&(s[a]=e[a]);return s}Object.defineProperty(exports,"__esModule",{value:!0});var n,i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},l=t(2),o=s(l),u=t(280),m=s(u),c=t(1),d=(s(c),t(7)),f=s(d),p=t(18),h=s(p),S=f.default.getActions("UsersAndStreams"),v=h.default.getStore("Users"),g=m.default.propTypes;g.onValueChange=o.default.PropTypes.func,g.size=o.default.PropTypes.oneOf(["normal","small"]);var _=o.default.createClass((n={displayName:"SelectUsersStreams",propTypes:g,getDefaultProps:function(){return{size:"normal"}},getInitialState:function(){return{value:this.props.value,permission:"",change:!1}},componentDidMount:function(){this.reactSelectStyles.use(),this.reactSelectSmStyles.use()},componentWillReceiveProps:function(e){this.props.value!==e.value&&this.setState({value:e.value})},componentWillUnmount:function(){this.reactSelectStyles.unuse(),this.reactSelectSmStyles.unuse()},getValue:function(){return this.state.value},componentDidUpdate:function(){},clearValue:function(){this.refs.select.clearValue(new CustomEvent("fake"))}},a(n,"componentDidUpdate",function(){this.state.permission&&this.state.change&&(S.loadSelectedPermission(this.state.permission),console.log("action lancÃ©"+this.state.permission),this.setState({change:!1}))}),a(n,"_onChange",function(e){var t=this;this.setState({permission:""});for(var s=e.split(","),a=(s.length,0);a<s.length;a++){v.load(s[a]).done(function(e){t.setState({permission:t.state.permission+","+e.permissions,change:!0})})}this.setState({value:e}),this.props.onValueChange&&this.props.onValueChange(e)}),a(n,"reactSelectStyles",t(281)),a(n,"reactSelectSmStyles",t(282)),a(n,"render",function(){var e=this.props,t=(e.onValueChange,e.size),s=r(e,["onValueChange","size"]);return o.default.createElement("div",{className:"small"===t?"select-sm":""},o.default.createElement(m.default,i({ref:"select",onChange:this._onChange},s,{value:this.state.value})))}),n));exports.default=_,e.exports=exports.default},1383:function(e,exports,t){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0});var a=t(2),r=s(a),n=t(1),i=s(n),l=t(15),o=t(958),u=t(168),m=s(u),c=t(18),d=s(c),f=t(48),p=t(1057),h=s(p),S=t(7),v=s(S),g=t(5),_=s(g),b=t(75),y=s(b),x=t(1147),E=(s(x),t(273)),T=(s(E),t(1183)),P=s(T),U=t(1068),C=s(U),k=d.default.getStore("Users"),F=d.default.getStore("Streams"),I=d.default.getStore("UsersAndStreams"),N=d.default.getStore("IndexSets"),O=(v.default.getActions("IndexSets"),r.default.createClass({displayName:"UsersAndStreamsPage",mixins:[i.default.connect(I),i.default.connect(N),m.default],getInitialState:function(){return{usersName:[{}],streamsTitleList:[{}],streamsList:[{}],streamsUsers:void 0,selectedValuePermission:void 0,selectedValueIdStream:void 0}},componentDidMount:function(){this.loadUsersName(),this.loadStreamsTitleList(),this.loadStreamsList()},loadUsersName:function(){var e=this;k.loadUsers().done(function(t){e.setState({usersName:t.map(function(e){return{value:e.username,label:e.username}})})})},componentDidUpdate:function(){""==this.state.idStreamStore&&this.state.change&&(this.setState({streamsUsers:""}),this.setState({change:!1})),""==this.state.permissionStore&&this.state.change&&(this.setState({streamsUsers:""}),this.setState({change:!1}))},filterById:function(e){for(var t,s,a=0,r=0;r<e.permissions.length;r++)if(e.permissions[r].indexOf("streams")>=0){t=e.permissions[r];var n=this.state.idStreamStore;s=t.split(":");for(var i=n.split(","),l=0;l<i.length;l++)console.log(s),s[s.length-1].indexOf(i[l])>=0&&++a;if(a==i.length)return e}},loadUsersStreams:function(){var e=this;k.loadUsers().done(function(t){var s=t.filter(e.filterById);e.setState({streamsUsers:s.map(function(e){return{value:e.username,label:e.username}})})})},loadStreamsTitleList:function(){var e=this;F.listStreamsForAllUsers().then(function(t){e.setState({streamsTitleList:t.map(function(e){return{value:e.id,label:e.isFavoriteStream.toString()}})})})},loadStreamsList:function(){var e=this;F.listStreamsForAllUsers().then(function(t){e.setState({streamsList:t})})},formatSelectedOptions:function(e,t,s){var a=this;return s.filter(function(s){return a.isPermitted(e,[t+":"+s.id])}).map(function(e){return e.title}).join(",")},_onSave:function(e,t){F.save(t,function(){_.default.success("Stream has been successfully created.","Success")})},render:function(){if(this.state.idStreamStore&&this.state.change&&(this.loadUsersStreams(),this.setState({change:!1})),this.state.permissionStore)var e=this.formatSelectedOptions(this.state.permissionStore,"streams:read",this.state.streamsList);return r.default.createElement(f.DocumentTitle,{title:"Users & Streams"},r.default.createElement("div",null,r.default.createElement("span",null,r.default.createElement(f.PageHeader,{title:"Users and Streams",subpage:!0},r.default.createElement("span",null,"Here is the list of users with their streams availables."),null),r.default.createElement("label",{htmlfor:"name"},"Type or select an user"),r.default.createElement(P.default,{name:"form-field-name",value:"",options:this.state.usersName,multi:!0,placeholder:"Type or select an user"})),r.default.createElement("label",{htmlFor:"name"}," Stream(s) available(s)"),r.default.createElement(P.default,{placeholder:"Choose streams read permissions...",value:e,multi:!0,disabled:!0}),r.default.createElement("label",{htmlfor:"name"},"Type or select a stream"),r.default.createElement(C.default,{name:"form-field-name",value:"",options:this.state.streamsTitleList,multi:!0,placeholder:"Type or select a stream"}),r.default.createElement("label",{htmlfor:"name"}," User(s) who can see the stream"),r.default.createElement(C.default,{name:"form-field-name",value:this.state.streamsUsers,multi:!0,placeholder:"Type or select a stream"}),r.default.createElement(f.IfPermitted,{permissions:"streams:create"},r.default.createElement(h.default,{ref:"createStreamButton",bsSize:"large",bsStyle:"success",onSave:this._onSave,indexSets:this.state.indexSets,className:"createStreamsCss"})),r.default.createElement(f.IfPermitted,{permissions:"users:edit"},r.default.createElement(o.LinkContainer,{to:y.default.SYSTEM.AUTHENTICATION.USERS.CREATE},r.default.createElement(l.Button,{bsStyle:"success",className:"addUserCss"},"Add new user")))))}}));exports.default=O,e.exports=exports.default},968:function(e,exports,t){e.exports=t(10)(336)}});
//# sourceMappingURL=32.f4e666cd5ae6a3e3cac4.js.map