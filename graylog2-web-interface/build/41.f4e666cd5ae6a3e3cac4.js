webpackJsonp([41],{1370:function(e,exports,t){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0});var d=t(2),o=a(d),s=t(1),n=a(s),i=t(15),l=t(262),r=t(272),u=a(r),c=t(18),h=a(c),f=t(959),m=a(f),p=t(5),g=a(p),b=t(75),E=a(b),D=t(48),k=t(168),w=a(k),v=t(965),I=a(v),S=t(1041),_=a(S),y=t(1163),U=a(y),B=t(1466),C=a(B),T=h.default.getStore("Streams"),A=h.default.getStore("CurrentUser"),F=h.default.getStore("Dashboards"),R=h.default.getStore("Focus"),H=h.default.getStore("Widgets"),P=o.default.createClass({displayName:"ShowDashboardPage",propTypes:{history:o.default.PropTypes.object.isRequired,params:o.default.PropTypes.object.isRequired},mixins:[n.default.connect(A),n.default.connect(R),w.default],getInitialState:function(){return{locked:!0,forceUpdateInBackground:!1,streamIds:null}},componentDidMount:function(){var e=this;this.loadData(),this.listenTo(H,this.removeWidget),T.load(function(t){var a=t.reduce(function(e,t){return e[t.id]=t.id,e},{});e.setState({streamIds:a})}),this.loadInterval=setInterval(this.loadData,2e3),this.setState({forceUpdateInBackground:this.state.currentUser.preferences.updateUnfocussed})},componentWillUnmount:function(){this.loadInterval&&clearInterval(this.loadInterval)},DASHBOARDS_EDIT:"dashboards:edit",DEFAULT_HEIGHT:1,DEFAULT_WIDTH:2,loadData:function(){var e=this,t=this.props.params.dashboardId;F.get(t).then(function(t){e.isMounted()&&(t.widgets.sort(function(e,t){return e.id.localeCompare(t.id)}),e.state.dashboard&&(0,u.default)(e.state.dashboard,t)||e.setState({dashboard:t}))},function(a){a.additional&&404===a.additional.status&&(g.default.error("Unable to find a dashboard with the id <"+t+">. Maybe it was deleted in the meantime."),e.props.history.pushState(null,E.default.DASHBOARDS))})},shouldUpdate:function(){return Boolean(this.state.forceUpdateInBackground||this.state.focus)},removeWidget:function(e){e.delete&&this.loadData()},emptyDashboard:function(){return o.default.createElement(i.Row,{className:"content"},o.default.createElement(i.Col,{md:12},o.default.createElement(i.Alert,{className:"no-widgets"},"This dashboard has no widgets yet. Learn how to add widgets in the ",o.default.createElement(I.default,{page:m.default.PAGES.DASHBOARDS,text:"documentation"}),".")))},_defaultWidgetDimensions:function(e){var t={col:0,row:0},a=l.PluginStore.exports("widgets").filter(function(t){return t.type.toUpperCase()===e.type.toUpperCase()})[0];return a?(t.height=a.defaultHeight,t.width=a.defaultWidth):(t.height=this.DEFAULT_HEIGHT,t.width=this.DEFAULT_WIDTH),t},_dashboardIsEmpty:function(e){return 0===e.widgets.length},formatDashboard:function(e){var t=this;if(this._dashboardIsEmpty(e))return this.emptyDashboard();var a={};e.widgets.forEach(function(d){var o=e.positions[d.id]||{},s=t._defaultWidgetDimensions(d);a[d.id]={col:void 0===o.col?s.col:o.col,row:void 0===o.row?s.row:o.row,height:void 0===o.height?s.height:o.height,width:void 0===o.width?s.width:o.width}});var d=e.widgets.sort(function(e,t){var d=a[e.id],o=a[t.id];return d.col===o.col?d.row-o.row:d.col-o.col}).map(function(a){return o.default.createElement("div",{key:a.id,className:C.default.widgetContainer},o.default.createElement(U.default,{id:a.id,key:"widget-"+a.id,widget:a,dashboardId:e.id,locked:t.state.locked,shouldUpdate:t.shouldUpdate(),streamIds:t.state.streamIds}))});return o.default.createElement(i.Row,null,o.default.createElement("div",{className:"dashboard"},o.default.createElement(D.ReactGridContainer,{positions:a,onPositionsChange:this._onPositionsChange,locked:this.state.locked},d)))},_unlockDashboard:function(e){e.preventDefault(),this.state.locked&&this._toggleUnlock()},_toggleUnlock:function(){this.setState({locked:!this.state.locked})},_onPositionsChange:function(e){F.updatePositions(this.state.dashboard,e)},_toggleFullscreen:function(){var e=document.documentElement;e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()},_toggleUpdateInBackground:function(){var e=!this.state.forceUpdateInBackground;this.setState({forceUpdateInBackground:e}),g.default.success("Graphs will be updated "+(e?"even":"only")+" when the browser is in the "+(e?"background":"foreground"),"")},render:function(){if(!this.state.dashboard)return o.default.createElement(D.Spinner,null);var e=this.state.dashboard,t=void 0;this._dashboardIsEmpty(e)||(t=o.default.createElement("div",null,o.default.createElement(i.Button,{id:"update-unfocussed",bsStyle:"info",onClick:this._toggleUpdateInBackground},"Update in ",this.state.forceUpdateInBackground?"foreground":"background")," ",o.default.createElement(i.Button,{className:"toggle-fullscreen",bsStyle:"info",onClick:this._toggleFullscreen},"Fullscreen"),o.default.createElement(D.IfPermitted,{permissions:this.DASHBOARDS_EDIT+":"+e.id}," ",o.default.createElement(i.Button,{bsStyle:"success",onClick:this._toggleUnlock},this.state.locked?"Unlock / Edit":"Lock"))));var a=void 0;this._dashboardIsEmpty(e)||(a=o.default.createElement(D.IfPermitted,{permissions:this.DASHBOARDS_EDIT+":"+e.id},o.default.createElement("div",{id:"drag-widgets-description"},"Drag widgets to any position you like in ",o.default.createElement("a",{href:"#",role:"button",onClick:this._unlockDashboard},"unlock / edit")," mode.")));var d=this.state.locked||this._dashboardIsEmpty(e)?null:o.default.createElement(_.default,{id:e.id,action:"edit",title:e.title,description:e.description,buttonClass:"btn-info btn-xs"},o.default.createElement("i",{className:"fa fa-pencil"})),s=o.default.createElement("span",null,o.default.createElement("span",{"data-dashboard-id":e.id,className:"dashboard-title"},e.title),"Â ",d);return o.default.createElement(D.DocumentTitle,{title:"Dashboard "+e.title},o.default.createElement("span",null,o.default.createElement(D.PageHeader,{title:s},o.default.createElement("span",{"data-dashboard-id":e.id,className:"dashboard-description"},e.description),a,t),this.formatDashboard(e),o.default.createElement("div",{className:"clearfix"})))}});exports.default=P,e.exports=exports.default},1400:function(e,exports,t){exports=e.exports=t(19)(),exports.push([e.i,"._3HrW10n1kzGWl5PDY4B2uD{background-color:#fff;border:1px solid #d1d1d1;z-index:auto}",""]),exports.locals={widgetContainer:"_3HrW10n1kzGWl5PDY4B2uD"}},1466:function(e,exports,t){var a=t(1400);"string"==typeof a&&(a=[[e.i,a,""]]);t(20)(a,{});a.locals&&(e.exports=a.locals)}});
//# sourceMappingURL=41.f4e666cd5ae6a3e3cac4.js.map